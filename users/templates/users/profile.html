{%extends 'main/base.html'%}
{%load static%}

{%block title%}Profile{%endblock title%}

{%block link%}
<link type="text/css" href="{% static 'users/css/profile.css' %}" rel="stylesheet">
{%endblock link%}

{%block content%}
<div class="main-container">
    <div class="page-header">
        <h1>My Profile</h1>
        <p>Manage your account settings and preferences</p>
    </div>
    <!-- Tabs Navigation -->
    <div class="tabs-container">
        <div class="tabs-list">
            <a href="{% url 'users:profile' %}" class="tab-trigger {% if not edit_mode %}active{% endif %}">
                <i class='bx bx-user'></i>
                Profile
            </a>
            <button class="tab-trigger" onclick="showTab('orders')">
                <i class='bx bx-package'></i>
                Order History
            </button>
        </div>

        <!-- Profile Tab Content -->
        {%if user%}
        <div class="tab-content active" id="profile-tab">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-info">
                        <div class="avatar">
                            <img src="/placeholder.svg?height=64&width=64" alt="Profile" class="avatar-image">
                            <div class="avatar-fallback">{{ user.first_name|first }}{{ user.last_name|first }}</div>
                        </div>
                        <div class="profile-text">
                            <h2>Welcome, {{user.first_name}} {{user.last_name}}!</h2>
                            <p>Manage your personal information</p>
                        </div>
                    </div>
                    <div class="profile-actions">
                        {% if edit_mode %}
                        <a href="{% url 'users:profile' %}" class="cancel-btn">
                            <i class='bx bx-x'></i>
                            Cancel
                        </a>
                        {% else %}
                        <a href="{% url 'users:edit_profile_details' %}" class="edit-btn">
                            <i class='bx bx-edit'></i>
                            Edit Profile
                        </a>
                        {% endif %}
                    </div>
                </div>

                {% if edit_mode %}
                <!-- Режим редактирования -->
                <form method="post" action="{% url 'users:edit_profile_details' %}">
                    {% csrf_token %}
                    <div class="profile-content">
                        <div class="section">
                            <h3 class="section-title">
                                <i class='bx bx-user section-icon'></i>
                                Personal Information
                            </h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="id_first_name">First Name</label>
                                    {{ form.first_name }}
                                    {% if form.first_name.errors %}
                                    <div class="error-message">{{ form.first_name.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="form-group">
                                    <label for="id_last_name">Last Name</label>
                                    {{ form.last_name }}
                                    {% if form.last_name.errors %}
                                    <div class="error-message">{{ form.last_name.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="form-group">
                                    <label for="id_email">Email</label>
                                    {{ form.email }}
                                    {% if form.email.errors %}
                                    <div class="error-message">{{ form.email.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="form-group">
                                    <label for="id_phone">Phone</label>
                                    {{ form.phone }}
                                    {% if form.phone.errors %}
                                    <div class="error-message">{{ form.phone.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="separator"></div>

                        <div class="section">
                            <h3 class="section-title">
                                <i class='bx bx-map section-icon'></i>
                                Address Information
                            </h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="id_city">City</label>
                                    {{ form.city }}
                                    {% if form.city.errors %}
                                    <div class="error-message">{{ form.city.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="form-group full-width">
                                    <label for="id_address1">Primary Address</label>
                                    {{ form.address1 }}
                                    {% if form.address1.errors %}
                                    <div class="error-message">{{ form.address1.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="form-group full-width">
                                    <label for="id_address2">Secondary Address (Optional)</label>
                                    {{ form.address2 }}
                                    {% if form.address2.errors %}
                                    <div class="error-message">{{ form.address2.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="save-btn">
                                <i class='bx bx-check'></i>
                                Save Changes
                            </button>
                            <a href="{% url 'users:profile' %}" class="cancel-btn">
                                <i class='bx bx-x'></i>
                                Cancel
                            </a>
                        </div>
                    </div>
                </form>
                {% else %}
                <!-- Режим просмотра -->
                <div class="profile-content">
                    <div class="section">
                        <h3 class="section-title">
                            <i class='bx bx-user section-icon'></i>
                            Personal Information
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>First Name</label>
                                <span>{{ user.first_name|default:"Not specified" }}</span>
                            </div>
                            <div class="info-item">
                                <label>Last Name</label>
                                <span>{{ user.last_name|default:"Not specified" }}</span>
                            </div>
                            <div class="info-item">
                                <label>Email</label>
                                <span>{{ user.email|default:"Not specified" }}</span>
                            </div>
                            <div class="info-item">
                                <label>Phone</label>
                                <span>{% if user.phone %}{{ user.phone }}{% else %}Not specified{% endif %}</span>
                            </div>
                        </div>
                    </div>

                    <div class="separator"></div>

                    <div class="section">
                        <h3 class="section-title">
                            <i class='bx bx-map section-icon'></i>
                            Address Information
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>City</label>
                                <span>{% if user.city %}{{ user.city }}{% else %}Not specified{% endif %}</span>
                            </div>
                            <div class="info-item full-width">
                                <label>Primary Address</label>
                                <span>{% if user.address1 %}{{ user.address1 }}{% else %}Not specified{% endif %}</span>
                            </div>
                            <div class="info-item full-width">
                                <label>Secondary Address</label>
                                <span>{% if user.address2 %}{{ user.address2 }}{% else %}Not
                                specified{% endif %}<span>
                            </div>
                        </div>
                    </div>

                    <div class="separator"></div>

                    <div class="section">
                        <h3 class="section-title">Account Information</h3>
                        <div class="info-cards">
                            <div class="info-card">
                                <i class='bx bx-calendar info-icon'></i>
                                <div class="info-content">
                                    <span class="info-label">Member Since</span>
                                    <span class="info-value">{{ user.date_joined|date:"F d, Y" }}</span>
                                </div>
                            </div>
                            <div class="info-card">
                                <i class='bx bx-time info-icon'></i>
                                <div class="info-content">
                                    <span class="info-label">Last Login</span>
                                    <span class="info-value">{{ user.last_login|date:"F d, Y H:i" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {%endif%}

        <!-- Orders Tab Content -->
        <div class="tab-content" id="orders-tab">
            <div class="orders-card">
                <div class="orders-header">
                    <h2 class="orders-title">
                        <i class='bx bx-package section-icon'></i>
                        Order History
                    </h2>
                    <p class="orders-subtitle">Track your recent purchases and order status</p>
                </div>

                <div class="orders-list">
                    {%for order in orders%}
                    <a href="">
                        <div class="order-item">
                        <div class="order-main">
                            <div class="order-info">
                                <div class="order-header-row">
                                    <span class="order-id">#{{order.id}}</span>
                                    <span class="order-status {%if status == 'delivered'%}delivered{%else%}pending{%endif%}">{{order.status}}</span>
                                </div>
                                <h4 class="order-product">{{order.items}}</h4>
                                <p class="order-date">{{order.created_at}}</p>
                            </div>
                            <div class="order-price">${{order.price}}</div>
                        </div>
                    </div>
                    </a>
                    {%endfor%}

                    <!--                    <div class="order-item">-->
                    <!--                        <div class="order-main">-->
                    <!--                            <div class="order-info">-->
                    <!--                                <div class="order-header-row">-->
                    <!--                                    <span class="order-id">#002</span>-->
                    <!--                                    <span class="order-status processing">Processing</span>-->
                    <!--                                </div>-->
                    <!--                                <h4 class="order-product">Nike x Jakob</h4>-->
                    <!--                                <p class="order-date">June 03, 2025</p>-->
                    <!--                            </div>-->
                    <!--                            <div class="order-price">$75</div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->

                    <!--                    <div class="order-item">-->
                    <!--                        <div class="order-main">-->
                    <!--                            <div class="order-info">-->
                    <!--                                <div class="order-header-row">-->
                    <!--                                    <span class="order-id">#003</span>-->
                    <!--                                    <span class="order-status pending">Pending</span>-->
                    <!--                                </div>-->
                    <!--                                <h4 class="order-product">Air Jordan 1 Low OG 'Obsidian'</h4>-->
                    <!--                                <p class="order-date">June 04, 2025</p>-->
                    <!--                            </div>-->
                    <!--                            <div class="order-price">$90</div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Минимальный JS только для переключения табов
    function showTab(tabName) {
        const tabs = document.querySelectorAll('.tab-content');
        const triggers = document.querySelectorAll('.tab-trigger');

        tabs.forEach(tab => tab.classList.remove('active'));
        triggers.forEach(trigger => trigger.classList.remove('active'));

        document.getElementById(tabName + '-tab').classList.add('active');
        event.target.classList.add('active');
    }
</script>
{%endblock content%}

{%block footer%}{%endblock footer%}