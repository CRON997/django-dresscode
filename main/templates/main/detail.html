{%extends "main/base.html" %}
{%load static%}


{%block link%}
<link type="text/css" href="{% static 'main/css/detail.css' %}" rel="stylesheet">
{%endblock%}

{%block title%}{{product.name}}{%endblock%}

{%block content%}
<section class="product-details">
    <div class="product-container">
        <div class="product-image">
            <img src="{{product.image.url}}" alt="">
        </div>
        <div class="product-info">
            <h1 class="product-title">{{product.name}}</h1>
            {%if product.status_discount%}
            <div class="product-prices">
                <span class="price-discount">${{product.price}}</span>
                <span class="price-common">${{product.original_price}}</span>
                <span class="discount-label">{{product.percent}} OFF</span>
            </div>
            {%else%}
            <div class="product-prices">
                <span class="price-discount">${{product.price}}</span></div>
            {%endif%}
            <p class="product-description">{{product.description}}</p>
            <form hx-post="{% url 'cart:cart_add' product.id %}" hx-target="#cart-counter">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <input type="hidden" name="override" value="false">
                {% if product.shoes_sizes.exists or product.clothing_sizes.exists %}
                <input type="hidden" name="size_required" value="true">
                <div class="product-size">
                    <label for="size-select">Select Size</label>
                    <select name="size_id" id="size-select" required>
                        <option value="" disabled selected>Choose a size</option>
                        {% if product.shoes_sizes.exists %}
                        {% for size in product.shoes_sizes.all %}
                        <option value="{{ size.id }}">{{ size.name }}</option>
                        {% endfor %}
                        {% elif product.clothing_sizes.exists %}
                        {% for size in product.clothing_sizes.all %}
                        <option value="{{ size.id }}">{{ size.name }}</option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>
                {% endif %}
                <button class="add-to-cart" type="submit">Add to Cart</button>
            </form>

        </div>
    </div>

    <div class="comments-section">
        <h2>Customer Reviews</h2>
        <form class="comment-form" hx-post="{%url 'comments:add_comment' product.id product.slug%}"
              hx-target="#comments-list" hx-on:htmx:after-request="this.reset()">
            {%csrf_token%}
            {{form.text}}
            <button type="submit" id="submit-comment">Submit Review</button>
        </form>
        <div class="comments-list" id="comments-list">
            {% include 'main/partial/comments_list.html' %}
        </div>
    </div>


    {%if related_products%}
    <div class="recommended-products">
        <h2>Recommended Products</h2>
        <div class="products-grid">
            {% for recommended_product in related_products %}
            <div class="product-card">
                <div class="product-card-image">
                    <a href="{% url 'main:product_detail' recommended_product.id recommended_product.slug %}">
                        <img src="{{ recommended_product.image.url }}" alt="{{ recommended_product.name }}">
                    </a>
                </div>
                <div class="product-card-info">
                    <h3 class="product-card-title">
                        <a href="{% url 'main:product_detail' recommended_product.id recommended_product.slug %}">{{recommended_product.name}}</a>
                    </h3>
                    <div class="product-card-prices">
                        {% if recommended_product.status_discount %}
                        <span class="price-discount">${{ recommended_product.price }}</span>
                        <span class="price-common">${{ recommended_product.original_price }}</span>
                        <span class="discount-label">{{ recommended_product.percent }} OFF</span>
                        {% else %}
                        <span class="price-discount">${{ recommended_product.price }}</span>
                        {% endif %}
                    </div>
                    <form>
                        {% csrf_token %}
                        <input type="hidden" name="quantity" value="1">
                        <input type="hidden" name="override" value="false">
                        <button class="add-to-cart">Add to Cart</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {%endif%}
</section>
{%endblock%}


{%block footer%}{%endblock%}